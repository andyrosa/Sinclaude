<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinclaude Sinclair Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <!-- FOUC averted -->
    <script>
        function handleRequiredScriptError(scriptName) {
            alert(`Error: Failed to load required script ${scriptName}. The simulator will not work correctly.`);
        }
        
        function loadScriptWithCacheBust(src) {
            var script = document.createElement('script');
            script.src = src + '?cb=' + Date.now();
            script.onerror = function() { handleRequiredScriptError(src); };
            document.head.appendChild(script);
        }
        
        function loadStyleWithCacheBust(href) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href + '?cb=' + Date.now();
            document.head.appendChild(link);
        }
        
        loadScriptWithCacheBust('constants_and_css_vars.js');
        loadScriptWithCacheBust('ui.js');
        loadScriptWithCacheBust('boot.js');
        loadStyleWithCacheBust('styles.css');
    </script>
</head>

<body>
    <div class="top-row">
        <div class="section assembly-section">
            <h3 id="assembly-section-title">1. Assembly Code Input</h3>
            <div class="section-content">
                <div class="section-main section-main-flex">
                    <div id="assemblyEditor" class="assembly-editor">
                        <div class="assembly-columns">
                            <div id="addressColumn" class="address-column"></div>
                            <div id="opcodesColumn" class="opcodes-column"></div>
                            <div id="assemblyColumn" class="assembly-column" contenteditable="true" 
                                 data-placeholder="Type or paste your Z80 assembly code here..."></div>
                        </div>
                    </div>
                </div>
                <div class="section-controls">
                    <div class="controls">
                        <button type="button" class="clear-btn" onclick="sinclaude.clearAssembly()" title="Clear the assembly editor">Clear</button>
                        <button type="button" class="load-btn" onclick="sinclaude.loadDefaultAssembly()" title="Load a performance test that increments a counter and displays it in hexadecimal">Load Default Program</button>
                        <button type="button" class="load-btn" onclick="sinclaude.loadBasicsAssembly()" title="Load a test program that demonstrates basic Z80 instructions - starts halted for single-stepping">Load Basics Test</button>
                        <button type="button" class="load-btn" onclick="sinclaude.loadSpaceInvaderAssembly()" title="Load a playable Space Invader micro-game">Load 'Space Invader'</button>
                        <button type="button" id="assemble-run-btn" onclick="sinclaude.assembleAndRun()" title="Compile the Z80 assembly code and start execution">Assemble and Run</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="section listing-section">
            <h3 title="Click to collapse/expand section">2. Magazine Listing 
                <button type="button" class="header-item" onclick="event.stopPropagation(); window.sinclaude.expandElement('machineCode')" title="Expand Magazine Listing">‚§¢</button>
                <button type="button" class="header-item" onclick="event.stopPropagation(); copyMagazineListingToClipboard()" title="Copy magazine listing to clipboard">üìã</button>
            </h3>
            <div class="section-content">
                <div class="section-main">
                    <div id="machineCode"></div>
                </div>
            </div>
        </div>
        <div class="header-items">
            <button type="button" class="header-item" onpointerdown="expandAssemblyTextarea()" title="Expand Editor">‚§¢</button>
            <button type="button" class="header-item" onclick="toggleMenu()" title="Menu">üçî</button>
            <div class="menu-dropdown" id="menuDropdown">
                <a href="#" onclick="showAbout(); return false;" class="menu-item">About</a>
                <a href="https://andyrosa.github.io/Sinclaude/" target="_blank" rel="noopener" class="menu-item" onclick="closeMenu();">Docs</a>
                <a href="https://github.com/andyrosa/Sinclaude" target="_blank" rel="noopener" class="menu-item" onclick="closeMenu();">Repo</a>
                <a href="#" onclick="toggleRetroFontsFromMenu(); return false;" class="menu-item" id="retroFontsToggle">‚úì Retro Fonts</a>
            </div>
        </div>
    </div>

    <div class="section console-section">
        <h3 title="Click to collapse/expand section">3. Console Output 
            <button type="button" class="header-item" onclick="event.stopPropagation(); window.sinclaude.expandElement('console')" title="Expand Console Output">‚§¢</button>
        </h3>
        <div class="section-content">
            <div class="section-main">
                <div id="console"></div>
            </div>
            <div class="section-controls">
                <div class="controls">
                    <button type="button" onclick="clearConsole()" title="Clear the console output">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <div class="section execution-section">
        <h3>4. Execution</h3>
        <div class="section-content">
            <div id="screen"></div>
            <div class="execution-controls">
                <div class="controls game-buttons" id="gameButtons">
                    <!-- Buttons generated by JavaScript -->
                </div>
                <div class="button-caption-edit-toggle" onclick="toggleButtonCaptionEdit()"></div>
                <div class="controls" id="executionControls">
                    <!-- Dynamic buttons will be rendered here based on state -->
                </div>
                <div class="debug">
                    <div>PC: <span id="regPC">-</span></div>
                    <div>Op Code: <span id="currentInstruction">-</span></div>
                    <div>SP: <span id="regSP">-</span></div>
                    <div>Stack: <span id="stackContents">---- ----</span></div>
                    <div>A: <span id="regA">-</span></div>
                    <div>Zero: <span id="flagZ">-</span></div>
                    <div>Carry: <span id="flagC">-</span></div>
                    <div>BC: <span id="regBC">-</span></div>
                    <div>DE: <span id="regDE">-</span></div>
                    <div>HL: <span id="regHL">-</span></div>
                    <div>I/O Ports: <span id="ports">-</span></div>
                    <div>MIPS: <span id="mips">-</span></div>
                    <div>Frame Rate Hz: <span id="refreshRate">-</span></div>
                    <div>Key: <span id="keyCodeCurrent">-</span></div>
                </div>
                <div id="keyboardStatus" class="keyboard-status"></div>
            </div>
        </div>
    </div>

</body>

</html>